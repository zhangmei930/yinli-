<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>注册</title>
		<link rel="stylesheet" type="text/css" href="../font/iconfont.css"/>
	    <link rel="stylesheet" type="text/css" href="../css/register.css"/>
	    <link rel="stylesheet" type="text/css" href="../lib/bootstrap/css/bootstrap.min.css"/>
        <script src="../lib/jquery/jquery-1.12.4.min.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<!--导航-->
	    <div class="nav">
		    <p>送至：<span>四川成都市</span></p>
		    <ul>
		  	    <li><a href="#">登录</a></li>
		        <li><a href="#">我的订单</a></li>
		  	    <li>
		  		    <a href="#">银犁APP</a>
		  		    <div class="contact">
		  		    	<div>
		  			        <img src="../../images/Android.png"/>
		  			        <span>Android下载</span>
		  		        </div>
		  		        <div>
		  		    	    <img src="../../images/iOS.png"/>
		  		    	    <span>ios敬请期待</span>
		  		         </div>
		  		    </div>  
		  	    </li>
		  	    <li>
		  	    	<a href="#">客服</a>
		  	    	<p>400-1111-028</p>
		  	    </li>
		  </ul>
	    </div>
	    <!--标志-->
	    <div class="logoList">
	    	<h1>
		    	<a href=""><img src="../images/PC-LOGO.png"/></a>
		    </h1>
	    </div>
	    <!--注册-->
	    <div class="registers">
	    	<div class="panel">	
	    		<div class="registerer">
	    			<div class="registerList">
	    				<h1>注册</h1>
						<form action="register.php" method="post">
							<input type="text" name="username" id="username" placeholder="请输入手机号码"><span id="username_info"></span><br>
							<input type="password" name="password" id="password" placeholder="请输入密码"><span id="password_info"></span><br>
							<input type="password" name="password" id="password" placeholder="请再次输入密码"><span id="password_info"></span><br>
							<div class="test">
								<input type="text" name="code" id="code" placeholder="请输入手机验证码" class="telTest"><span id="username_info"></span>
							    <input type="button" value="发送验证码" class="sendTest"><br>
							</div>
							<label><input type="checkbox" checked="checked" id="remember">我已阅读并同意<span><a href="">《银犁用户注册协议》</a></span></label>
							<input type="submit" value="注册" class="regis">
						</form>
	    			</div>
	    			<div class="logines">
			    	    <a href="" class="one">手机密码登录 </a>
			    		<span>|</span>
			    		<a href="">手机验证码登录</a>
			    	</div>
	    		</div>
	    	</div>
	    </div>
	    <!--尾部-->
	    <div class="context">
	    	<p><a href="">关于我们</a> | <a href="">联系我们</a></p>
	    	<p>Copyright &copy; 2017-2030银犁食品&nbsp;(ylfood.com) All rights reserved.&nbsp;&nbsp;蜀ICP备：11006129号-3 网站统计 站长统计</p>
	    </div>
	       
	       
	       
	       
	       
	    
	    
	    <script type="text/javascript">

			var isExist = true; // 标记输入的用户名是否存在
	
			// 用户名以字母开头，可包含数字字母下划线字符，长度在4到20位之间
			function ckUsername() {
				var result = /^[a-zA-Z]\w{3,19}$/.test($("#username").value);
				$("#username_info").innerHTML = "";
				if (!result)
					$("#username_info").innerHTML = "用户名格式有误";
	
				return result;
			}
			$("#username").onblur = function(){
				// 用户名文本框失去焦点，首先格式			验证格式是否正确，再验证用户名是否已被占用
				// 格式
				if(!ckUsername())
					return;
				// 是否被占用，使用 ajax
				// a. 创建核心对象
				var xhr = new XMLHttpRequest();
				// b. 建立连接(打开连接)
				xhr.open("get", "check.php?username=" + this.value, true);
				// c. 发送请求
				xhr.send();
				// d. 处理响应
				xhr.onreadystatechange = function(){
					if (xhr.readyState === 4) { // 请求处理完毕，响应就绪
						if (xhr.status === 200) { // OK，正常请求到资源
							// 获取响应数据
							var data = xhr.responseText;
							// 数据处理逻辑
							// console.log(data);
							data = JSON.parse(data);
							if (data.status === 0) {
								$("#username_info").innerHTML = "用户名已存在，请重新选择新用户名";
								isExist = true; // 标记用户存在
							} else {
								$("#username_info").innerHTML = "用户名可用";
								isExist = false; // 标记用户不存在
							}
						}
					}
				}
			};
			// 密码可以是任意字符，长度在6-20位之间
			function ckPassword() {
				var result = /^.{6,20}$/.test($("#password").value);
				$("#password_info").innerHTML = "";
				if (!result)
					$("#password_info").innerHTML = "密码格式有误";
	
				return result;
			}
			$("#password").onblur = ckPassword;
			// 身份证号码为 15位或18位，18位的最后一位可以为 x
			function ckCid() {
				var result = /(^\d{15}$)|(^\d{17}(\d|[Xx])$)/.test($("#cid").value);
				$("#cid_info").innerHTML = "";
				if (!result)
					$("#cid_info").innerHTML = "身份证号码格式有误";
	
				return result;
			}
			$("#cid").onblur = ckCid;
	
			// 表单提交事件
			$("form")[0].onsubmit = function(e){
				e = e || event;
				// 阻止表单的提交
				e.preventDefault ? e.preventDefault() : e.returnValue = false;
	
				if (!(ckUsername() && ckPassword() && ckCid()) || isExist){
					return;
				}
	
				// 向服务器提交注册用户信息：ajax
				// 1. 创建核心对象
				var xhr = new XMLHttpRequest();
				// 2. 建立连接
				xhr.open("post", "register.php", true);
				// 3. 发送请求
				var queryString = "username=" + $("#username").value + "&password=" + $("#password").value + "&cid=" + $("#cid").value;
				xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
				xhr.send(queryString);
				// 4. 处理响应
				xhr.onreadystatechange = function(){
					if (xhr.readyState === 4) {
						if (xhr.status === 200) {
							var data = xhr.responseText;
							data = JSON.parse(data);
							/*if (data.status === 1) {
								// 将注册成功的用户信息保存到 cookie 中
								setCookie("user", JSON.stringify(data.user));
								location = "success.html";
							}*/
							if (data.status === 1) {
								var queryString = `username=${data.user.username}&nickname=${data.user.nickname}&score=${data.user.score}&level=${data.user.level}`;
								location = "success.html?" + queryString;
							}
						}
					}
				}
			}
		</script>
	</body>
</html>
